---
alwaysApply: false
description: App plugin architecture patterns and critical implementation paths.
---

# System Patterns

## App Plugin Architecture

This Grafana App Plugin integrates as a sidebar panel using **Grafana Scenes** for state management. Key architectural layers:

- **Extension Layer**: Sidebar components and navigation links registered via plugin.json
- **Data Layer**: Multi-strategy content fetchers with fallbacks for external docs and recommender service
- **External Layer**: ML-based recommender service and Grafana.com documentation

## Plugin-Specific Decisions

- **Grafana Scenes over React Router**: Leverages Grafana's native scene-based navigation and state management
- **localStorage Tab Persistence**: Browser-like multi-tab experience survives page reloads
- **Context-Aware Recommendations**: Analyzes current Grafana state (page, datasources, dashboard) to suggest relevant content
- **Interactive Elements System**: Custom `data-targetaction` attributes enable "Show me"/"Do it" automation of Grafana UI actions
- **@dnd-kit for Drag-and-Drop**: All sortable/draggable interactions should use @dnd-kit library for built-in accessibility, touch device support, smooth animations, and consistency.

**Important**: Do NOT implement drag-and-drop using native HTML5 DnD or other libraries. Always use the @dnd-kit components to maintain consistency and accessibility

## Component Relationships

- `App.tsx` → Scene setup and auto-launch logic
- `CombinedLearningJourneyPanel` → Tab orchestration and content rendering (`docs-panel.tsx`)
- `ContextPanel` → Recommendations display using `useContextPanel` hook (`context-panel.tsx`)
- **Interactive Engine** → Business logic in `src/interactive-engine/`
- **Context Engine** → Context analysis in `src/context-engine/`
- **Requirements Manager** → Requirements validation in `src/requirements-manager/`
- **Utils** → General utilities in `src/utils/` (keyboard shortcuts, link handling)
- **Styles** → Theme-aware functions in `src/styles/*.styles.ts`

## Critical Implementation Paths

**Context Analysis → Recommendations**:
1. `context-engine/context.service.ts` → Extract context tags from Grafana state
2. `context-engine/context.service.ts` → Call recommender service
3. `context-engine/context.hook.ts` (useContextPanel) → Process and render recommendations
4. User interaction → Tab creation with content

**Content Loading with Interactive Elements**:
1. `docs-retrieval/content-fetcher.ts` → Multi-strategy HTML fetching with fallbacks
2. `docs-retrieval/html-parser.ts` → Parse HTML to React component tree
3. `docs-retrieval/content-renderer.tsx` → Render React components with interactive elements
4. `interactive-engine/interactive.hook.ts` (useInteractiveElements) → Handle "show me"/"do it" events, check requirements, highlight/automate UI elements
5. `requirements-manager/step-checker.hook.ts` → Validate requirements and objectives
6. Render in tab with progress tracking

## Gamification System Architecture

**Data Flow**:
- Guide completion → `user-storage.ts:markGuideCompleted()` → Check badges → Update streak → Dispatch events
- `useLearningPaths` hook → Subscribes to events → Updates React state
- Badge toasts queued and shown sequentially

**Key Components**:
- `LearningPathCard` → Collapsible card with progress ring, expandable guide list
- `BadgeUnlockedToast` → Celebratory modal with confetti, auto-dismiss with queue support
- `ProgressRing` → SVG circular progress indicator with gradient stroke
- `StreakIndicator` → Fire emoji with day count display

**Badge Triggers**:
- `guide-completed` → Any/specific guide completion
- `path-completed` → All guides in a path finished
- `streak` → Consecutive days of activity (3-day, 7-day milestones)

**Learning Paths Critical Path**:
1. `learning-paths/paths.json` → Define learning paths with ordered guide sequences
2. `learning-paths/badges.ts` → Badge definitions and trigger conditions
3. `learning-paths/streak-tracker.ts` → Daily streak calculation logic
4. `learning-paths/learning-paths.hook.ts` → Main React hook for state management
5. `lib/user-storage.ts:learningProgressStorage` → Persists progress in localStorage
6. `components/LearningPaths/MyLearningTab.tsx` → Main UI for gamified experience
7. Progress events dispatched via `learning-progress-updated` CustomEvent

**Analytics Events**:
- `learning_path_progress` → Tracks path interaction with completion %
- `badge_unlocked` → Tracks badge awards with trigger type
