---
alwaysApply: false
description: App plugin architecture patterns and critical implementation paths.
---

# System Patterns

## App Plugin Architecture

This Grafana App Plugin integrates as a sidebar panel using **Grafana Scenes** for state management. Key architectural layers:

- **Extension Layer**: Sidebar components and navigation links registered via plugin.json
- **Data Layer**: Multi-strategy content fetchers with fallbacks for external docs and recommender service
- **External Layer**: ML-based recommender service and Grafana.com documentation

## Plugin-Specific Decisions

- **Grafana Scenes over React Router**: Leverages Grafana's native scene-based navigation and state management
- **localStorage Tab Persistence**: Browser-like multi-tab experience survives page reloads
- **Context-Aware Recommendations**: Analyzes current Grafana state (page, datasources, dashboard) to suggest relevant content
- **Interactive Elements System**: Custom `data-targetaction` attributes enable "Show me"/"Do it" automation of Grafana UI actions

## Component Relationships

- `App.tsx` → Scene setup and auto-launch logic
- `CombinedLearningJourneyPanel` → Tab orchestration and content rendering
- `ContextPanel` → Recommendations display using `useContextPanel` hook
- **Hooks** → Business logic in `src/utils/*.hook.ts`
- **Styles** → Theme-aware functions in `src/styles/*.styles.ts`

## Critical Implementation Paths

**Context Analysis → Recommendations**:
1. `context-analysis.ts` → Extract context tags from Grafana state
2. `context-data-fetcher.ts` → Call recommender service
3. `useContextPanel` → Process and render recommendations
4. User interaction → Tab creation with content

**Content Loading with Interactive Elements**:
1. `docs-fetcher.ts` → Multi-strategy HTML fetching with fallbacks
2. `useContentProcessing` → Parse HTML, inject interactive buttons, resolve asset URLs
3. `useInteractiveElements` → Handle "show me"/"do it" events, check requirements, highlight/automate UI elements
4. Render in tab with progress tracking